
# Форматирование строк

- **[Форматирование строк “По старинке” (оператор %)](#Форматирование%20строк%20“По%20старинке”%20(оператор%20%))**
- **[Форматирование методом `str.format()`](#Форматирование%20методом%20`str.format()`)**
- **[Форматирование f-строками](#Форматирование%20f-строками)**


## Форматирование строк “По старинке” (оператор %)
---
```python
name = 'Bob'
print('Hello, %s' % name)
# Вывод: "Hello, Bob"
```

Несколько значений заключаются в кортеж
```python
errno = 50159747054
name = 'Bob'
print('Hey %s, there is a 0x%x error!' % (name, errno))
# 'Hey Bob, there is a 0xbadc0ffee error!'
```

Обращение по ключю словаря
```python
print(
    'Hey %(name)s, there is a 0x%(errno)x error!' % {
        "name": 'Bob', "errno": 50159747054}
)
# Вывод: 'Hey Bob, there is a 0xbadc0ffee error!'
```

```python
print(
	  '%f, &.2f, %+.*f*' % (1/3.0, 1/3.0, 4, 1/3.0)
)
# 0.333333, 0.33, +0.3333
```

Спецификатор преобразования содержит два или более символов и содержит следующие компоненты, которые должны выполняться в следующем порядке:
```
%[(Имя_ключа)][признаки][ширина][.точность]код_типа
```

1.  Символ `%`, который отмечает начало спецификатора.
2.  Ключ сопоставления (необязательно), состоящий из заключенной в скобки последовательности символов, например, (somename).
3.  Флаги преобразования (необязательно), которые влияют на результат некоторых типов преобразования.
4.  Минимальная ширина поля (необязательно). Если указано как `'*'`- звездочка, фактическая ширина считывается из следующего элемента кортежа в значениях и объект для преобразования следует после минимальной ширины поля и необязательной точности.
5.  Точность (необязательно), задается как `'.'` - точка, за которой следует точность. Если указано как `'*'` - звездочка, фактическая точность считывается из следующего элемента кортежа в значениях, а значение для преобразования следует после точности.
6.  Модификатор длины (необязательно).
7.  Тип конверсии.

**Символами флагов преобразований являются**:

-   `'#'` - Преобразование значения будет использовать "альтернативную форму"
-   `'0'` - Преобразование будет дополнено нулями для числовых значений.
-   `'-'` - Преобразованное значение корректируется слева, отменяет `'0'` преобразование, если заданы оба.
-   `' '` - пробел. Пробел должен быть оставлен перед положительным числом или пустой строкой, полученным в результате преобразования со знаком.
-   `'+'` - Знак, `'+'` или `'-'`, будет предшествовать преобразованию. Заменяет флаг "пробел".

**Типы конверсии**:

-   `'d'` - Десятичное число со знаком
-   `'i'` - Десятичное число со знаком
-   `'o'` - Восьмеричное значение со знаком. Вызывает вставку восьмеричного спецификатора `'0o'` перед первой цифрой.
-   `'u'` - Устаревший тип - он идентичен `'d'`.
-   `'x', 'X'` - Шестнадцатеричный формат. Перед первой цифрой вставляется начальная буква `'0x'` или `'0X'`
-   `'e', 'E'` - Экспоненциальный формат с плавающей запятой.
-   `'f', 'F'` - Десятичный формат с плавающей точкой. Cодержит десятичную точку, даже если за ней нет цифр.
-   `'g', 'G'` - Формат с плавающей точкой. Использует экспоненциальный формат в нижнем регистре, если показатель степени меньше `-4`, в противном случае используется десятичный формат. Всегда содержит десятичную точку, а завершающие нули не удаляются.
-   `'c'` - Один символ. Принимает целое число или одну строку символов.
-   `'r'` - Строка. Преобразует любой объект Python, используя встроенную функцию [`repr()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-repr/ "Функция repr() в Python, описание объекта."). Если точность равна `N`, вывод усекается до `N` символов.
-   `'s'` - Строка. Преобразует любой объект Python, используя встроенную класс [`str()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/klass-str/ "Класс str() в Python, преобразует объект в строку.").
-   `'a'` - Строка. Преобразует любой объект Python, используя встроенную функцию [`ascii()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-ascii/ "Функция ascii() в Python, преобразует строку в ASCII.").
-   `'%'` - Никакой аргумент не преобразуется, в результате получается символ `'%'`.
<br><br>
## Форматирование методом `str.format()`
---

Метод `str.format()` выполняет операцию форматирования строки `str`. Возвращает копию строки, в которой каждое замещающее поле заменяется строковым значением соответствующего аргумента.

Строки `str` метода `str.format()` содержат "замещающие поля", заключенные в фигурные скобки `{}`. Все, что не содержится в фигурных скобках, считается буквальным текстом, который копируется без изменений в выходные данные.

Если необходимо включить в текст дополнительные символы скобок, то это можно сделать путем их удвоения, например `{{текст}}`].

Каждое замещающее поле `{}` содержит либо числовой индекс позиционного аргумента, либо имя ключевого аргумента.


### Грамматика поля замены выглядит следующим образом:

```
"{" [ field_name] [ "!" conversion] [ ":" format_spec] "}"
# где:
# - field_name - это *args и(или) **kwargs
# - conversion - это 'r' или 's' или 'a'
# - format_spec - это Спецификация формата Mini-Language
```

Поле замены {...} может начинаться с `field_name`, указывающего объект, значение которого должно быть отформатировано и вставлено в выходные данные. За полем `field_name`, необязательно должны следовать поля: `conversion`, которому предшествует восклицательный знак `'!'`, и `format_spec`, которому предшествует двоеточие `':'`. Они задают формат замены, отличный от формата по умолчанию.

**Поле `field_name`**  
Поле является либо числом, либо ключевым словом. Если это число, то оно ссылается на позиционный аргумент, а если ключевое слово, то на именованный аргумент ключевого слова.

Если в строке формата `'... {0} ... {1} ... {2}'.format(a, b, c)` числа являются номерами позиционных аргументов, они все могут быть опущены, а индексы позиционных аргументов 0, 1, 2, ... будут автоматически вставлены.


**Поле `conversion`**  
Поле преобразования `conversion` вызывает приведение типа перед форматированием. Обычно задание форматирования значения выполняется методом `__format__()` самого значения. Однако в некоторых случаях желательно принудительно форматировать тип в виде строки, переопределяя его собственное определение форматирования. При преобразовании значения в строку перед вызовом `__format__()` обычная логика форматирования игнорируется.

В настоящее время поддерживаются три флага преобразования:

-   `'!s '` - вызывает [`str()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/klass-str/ "Класс str() в Python, преобразует объект в строку.") по значению,
-   `'!r'` - вызывает [`repr()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-repr/ "Функция repr() в Python, описание объекта."),
-   `'!a'` - вызывает [`ascii()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-ascii/ "Функция ascii() в Python, преобразует строку в ASCII.").

**Поле `format_spec`**  
Cодержит [спецификацию формата "Mini-Language"](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-format/ "Функция format() в Python, форматирует значение переменной."). Эта спецификация определяет, как должно быть представлено значение, включая такие детали, как ширина поля, выравнивание, заполнение, десятичная точность и так далее. Большинство встроенных типов поддерживают спецификацию формата "Mini-Language", который описан во встроенной функции [`format()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-format/ "Функция format() в Python, форматирует значение переменной.").

```python
print('We are the {} who say "{}!"'.format('knights', 'Ni'))
# We are the knights who say "Ni!"

>>> yes_votes = 42_572_654
>>> no_votes = 43_132_495
>>> percentage = yes_votes / (yes_votes + no_votes)
>>> '{:-9} YES votes  {:2.2%}'.format(yes_votes, percentage)
# ' 42572654 YES votes  49.67%'
```

```python
>>> print('{0} and {1}'.format('spam', 'eggs'))
# spam and eggs

>>> print('{1} and {0}'.format('spam', 'eggs'))
# eggs and spam
```

Если в методе `str.format()` используются ключевые аргументы, на их значения ссылается имя аргумента.

```python
>>> print('This {food} is {adjective}.'.format(
...       food='spam', adjective='absolutely horrible'))
# This spam is absolutely horrible.
```

Позиционные и ключевые аргументы могут быть произвольно объединены:

```python
>>> print('The story of {0}, {1}, and {other}.'.format(
...       'Bill', 'Manfred', other='Georg'))
# The story of Bill, Manfred, and Georg.
```

Если строка формата очень длинная, которую не хотите разделять, было бы неплохо, если бы вы могли ссылаться на переменные, которые должны быть отформатированы по имени, а не по позиции. Это можно сделать, передавая [словарь `dict`](https://docs-python.ru/tutorial/osnovnye-vstroennye-tipy-python/tip-dannyh-dict-slovar/ "Словарь dict в Python.") и используя квадратные скобки `'[]'` для доступа к ключам.

```python
>>> table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 8637678}
>>> print('Jack: {0[Jack]:d}; Sjoerd: {0[Sjoerd]:d}; '
...       'Dcab: {0[Dcab]:d}'.format(table))
# Jack: 4098; Sjoerd: 4127; Dcab: 8637678
```

Это также можно сделать, передав переменную словаря `table` в качестве аргументов ключевого слова с обозначением `**` - знака [распаковки словаря](https://docs-python.ru/tutorial/opredelenie-funktsij-python/args-kwargs-proizvolnoe-chislo-argumentov/ "Переменные аргументов *args и **kwargs в функции Python.").

```python
>>> table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 8637678}
>>> print('Jack: {Jack:d}; Sjoerd: {Sjoerd:d}; Dcab: {Dcab:d}'.format(**table))
# Jack: 4098; Sjoerd: 4127; Dcab: 8637678
```

Настраиваемое форматирование
```python
print(
	  '{:f}, {:.2f}, {:+.{}f}'.format(1/3.0, 1/3.0)
)
```

<br><br>
## Форматирование f-строками
---
Форматированные строковые литералы, также называемые "f-строками" для краткости, позволяют включать значение выражений Python в строку, добавляя префикс к строке `'f'` или `'F'` и записывая выражения внутри строки как `{expression}`.

```python
>>> year = 2016
>>> event = 'Referendum'
>>> f'Results of the {year} {event}'
# 'Results of the 2016 Referendum'
```

Необязательный [спецификатор формата Mini-Language](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-format/ "Функция format() в Python, форматирует значение переменной.") может следовать за выражением. Это позволяет лучше контролировать форматирование значения. Следующий пример округляет число до десяти после десятичного числа:

```python
>>> import math
>>> print(f'The value of pi is approximately {math.pi:.3f}.')
# The value of pi is approximately 3.142.
```

Передача [целого числа](https://docs-python.ru/tutorial/osnovnye-vstroennye-tipy-python/tip-dannyh-int-tselye-chisla/ "Целые числа int в Python.") после `':'` символа приведет к минимальному количеству символов в этом поле. Это полезно для выравнивания столбцов.

```python
>>> table = {'Sjoerd': 4127, 'Jack': 4098, 'Dcab': 7678}
>>> for name, phone in table.items():
...     print(f'{name:10} ==> {phone:10d}')
...
# Sjoerd     ==>       4127
# Jack       ==>       4098
# Dcab       ==>       7678
```

Другие модификаторы могут использоваться для преобразования значения перед его форматированием. `'!a'` применяется [`ascii()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-ascii/ "Функция ascii() в Python, преобразует строку в ASCII."), `'!s'` применяется [`str()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/klass-str/ "Класс str() в Python, преобразует объект в строку.") и `'!r'` применяется [`repr()`](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-repr/ "Функция repr() в Python, описание объекта."):

```python
>>> animals = 'eels'
>>> print(f'My hovercraft is full of {animals}.')
# My hovercraft is full of eels.

>>> print(f'My hovercraft is full of {animals!r}.')
# My hovercraft is full of 'eels'.
```

Поддержка f-строками [спецификации формата Mini-Language](https://docs-python.ru/tutorial/vstroennye-funktsii-interpretatora-python/funktsija-format/ "Функция format() в Python, форматирует значение переменной.").

```python
>>> b = 2999
>>> pi = 3.1415926
>>> f'Pi={pi:.3f}, b={b:*^11.2f}'
# 'Pi=3.142, b=**2999.00**'

>>> print("\n".join(f'{a:{a}<{a}}' for a in range(1, 6)))
# 1
# 22
# 333
# 4444
# 55555
```